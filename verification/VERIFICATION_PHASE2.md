# Phase 2 κ²€μ¦ λ¬Έμ„ - LiteLLM ν†µν•© + λ―Όκ°μ •λ³΄ μ²λ¦¬

## π“‹ Phase 2 μ²΄ν¬λ¦¬μ¤νΈ

### β… LiteLLM ν΄λΌμ΄μ–ΈνΈ κµ¬ν„
- [x] Claude API νΈν™ ν•μ‹ μ§€μ› (μ”μ²­/μ‘λ‹µ λ³€ν™)
- [x] λΉ„λ™κΈ° API νΈμ¶ μ²λ¦¬ (litellm.acompletion)
- [x] λ¨λΈ μ„¤μ • λ° νλΌλ―Έν„° κ΄€λ¦¬ (κΈ°λ³Έκ°’, μ»¤μ¤ν…€ μ„¤μ •)
- [x] μ—λ¬ μ²λ¦¬ λ° μ¬μ‹λ„ λ©”μ»¤λ‹μ¦
- [x] ν—¬μ¤μ²΄ν¬ λ° μ—°κ²° μƒνƒ λ¨λ‹ν„°λ§

### β… λ΅κΉ… μ‹μ¤ν… κµ¬ν„
- [x] κµ¬μ΅°ν™”λ λ΅κΉ… μ„¤μ • (λ λ²¨, ν¬λ§·, ν•Έλ“¤λ¬)
- [x] λ¨λ“λ³„ λ…λ¦½μ  λ΅κ±° κ΄€λ¦¬
- [x] ν”„λ΅λ•μ… ν™κ²½ μ ν•©ν• λ΅κ·Έ μ¶λ ¥

### β… FastAPI μ„λ²„ ν†µν•©
- [x] μ• ν”λ¦¬μΌ€μ΄μ… μƒλ…μ£ΌκΈ° κ΄€λ¦¬ (startup/shutdown)
- [x] λ§μ¤ν‚Ή μ‹μ¤ν… + LiteLLM ν΄λΌμ΄μ–ΈνΈ ν†µν•© μ΄κΈ°ν™”
- [x] Claude API μ—”λ“ν¬μΈνΈ κµ¬ν„ (/v1/messages)
- [x] μΈμ¦ μ‹μ¤ν… (Bearer ν† ν°)
- [x] ν—¬μ¤μ²΄ν¬ μ—”λ“ν¬μΈνΈ (/health)

### β… μ”μ²­/μ‘λ‹µ λ§μ¤ν‚Ή νμ΄ν”„λΌμΈ
- [x] μ”μ²­ λ‚΄μ© λ§μ¤ν‚Ή (messages λ°°μ—΄ μ²λ¦¬)
- [x] LiteLLMμ„ ν†µν• μ‹¤μ  Claude API νΈμ¶
- [x] μ‘λ‹µ λ‚΄μ© λ³µμ› (content λ°°μ—΄ μ²λ¦¬)
- [x] λ§¤ν•‘ μ •λ³΄ μΌκ΄€μ„± λ³΄μ¥

### β… ν¬κ΄„μ  ν…μ¤νΈ λ° κ²€μ¦
- [x] LiteLLM ν΄λΌμ΄μ–ΈνΈ λ‹¨μ„ ν…μ¤νΈ (λ¨μ API μ‘λ‹µ)
- [x] ν†µν•© μ‹μ¤ν… κ²€μ¦ μ¤ν¬λ¦½νΈ (μ‹¤μ  λ™μ‘ ν™•μΈ)
- [x] μ„±λ¥ ν…μ¤νΈ (μ‘λ‹µ μ‹κ°„, μ²λ¦¬λ‰)
- [x] μ—λ¬ μ²λ¦¬ λ° λ³µκµ¬ ν…μ¤νΈ

---

## π” κ²€μ¦ λ€μƒ λ° μ„Έλ¶€ λ‚΄μ©

### 1. LiteLLM ν΄λΌμ΄μ–ΈνΈ ν•µμ‹¬ κΈ°λ¥ κ²€μ¦ (`litellm_client.py`)

**κ²€μ¦ λ©μ **: Claude APIμ™€ μ™„λ²½ν νΈν™λλ” LiteLLM ν΄λΌμ΄μ–ΈνΈκ°€ μ¬λ°”λ¥΄κ² κµ¬ν„λμ—λ”μ§€ ν™•μΈ

**κ²€μ¦ λ‚΄μ©**:
- **API ν‚¤ κ΄€λ¦¬**: ν™κ²½λ³€μλ¥Ό ν†µν• μ•μ „ν• μΈμ¦ μ •λ³΄ κ΄€λ¦¬
  ```python
  self.claude_api_key = os.getenv("ANTHROPIC_API_KEY")
  ```
- **μ”μ²­ ν•μ‹ λ³€ν™**: Claude API μ”μ²­μ„ LiteLLM ν•μ‹μΌλ΅ μ •ν™•ν• λ³€ν™
  - model, messages, max_tokens, temperature λ“± λ¨λ“  νλΌλ―Έν„° μ§€μ›
  - system λ©”μ‹μ§€, stop_sequences λ“± κ³ κΈ‰ κΈ°λ¥ μ§€μ›
- **μ‘λ‹µ ν•μ‹ λ³€ν™**: LiteLLM μ‘λ‹µμ„ Claude API ν•μ‹μΌλ΅ μ •ν™•ν• μ—­λ³€ν™
  - content λ°°μ—΄ κµ¬μ΅° (`[{"type": "text", "text": "..."}]`)
  - usage ν† ν° μ •λ³΄ (`input_tokens`, `output_tokens`)
  - stop_reason λ§¤ν•‘ (`stop` β†’ `end_turn`, `length` β†’ `max_tokens`)
- **μ—λ¬ μ²λ¦¬**: API νΈμ¶ μ‹¤ν¨ μ‹ μ μ ν• μμ™Έ μ²λ¦¬ λ° λ΅κΉ…

**κ²€μ¦ λ°©λ²•**: `test_litellm_client.py::TestLiteLLMClient`
```python
async def test_call_claude_api_success(self, mock_completion):
    # LiteLLM λ¨μ μ‘λ‹µ μ„¤μ •
    mock_response = create_mock_litellm_response()
    mock_completion.return_value = mock_response
    
    # Claude API ν•μ‹ μ”μ²­
    request_data = {
        "model": "claude-3-5-sonnet-20241022",
        "messages": [{"role": "user", "content": "Hello"}],
        "max_tokens": 100
    }
    
    response = await client.call_claude_api(request_data)
    
    # Claude API ν•μ‹ μ‘λ‹µ κ²€μ¦
    assert response["content"][0]["text"] == "Hello, I'm Claude!"
    assert response["usage"]["input_tokens"] == 10
```

**κΈ°λ€ κ²°κ³Ό**: Claude APIμ™€ 100% νΈν™λλ” μ”μ²­/μ‘λ‹µ μ²λ¦¬

---

### 2. λ΅κΉ… μ‹μ¤ν… κ²€μ¦ (`logging.py`)

**κ²€μ¦ λ©μ **: ν”„λ΅λ•μ… ν™κ²½μ—μ„ μ•μ •μ μ΄κ³  κµ¬μ΅°ν™”λ λ΅κΉ…μ΄ κ°€λ¥ν•μ§€ ν™•μΈ

**κ²€μ¦ λ‚΄μ©**:
- **λ΅κ±° μ„¤μ •**: λ¨λ“λ³„ λ…λ¦½μ  λ΅κ±° μƒμ„± λ° κ΄€λ¦¬
  ```python
  logger = setup_logger(__name__, level="INFO")
  ```
- **μ¶λ ¥ ν•μ‹**: νƒ€μ„μ¤νƒ¬ν”„, λ¨λ“λ…, λ λ²¨, λ©”μ‹μ§€ ν¬ν•¨ν• κµ¬μ΅°ν™”λ ν•μ‹
- **λ λ²¨ κ΄€λ¦¬**: DEBUG, INFO, WARNING, ERROR λ λ²¨λ³„ μ μ ν• μ¶λ ¥
- **ν•Έλ“¤λ¬ μ¤‘λ³µ λ°©μ§€**: λ™μΌ λ¨λ“μ—μ„ μ—¬λ¬ λ² νΈμ¶ μ‹ ν•Έλ“¤λ¬ μ¤‘λ³µ μƒμ„± λ°©μ§€
- **μƒμ„ λ΅κ±° μ „ν λ°©μ§€**: μ¤‘λ³µ λ΅κ·Έ μ¶λ ¥ λ°©μ§€

**κ²€μ¦ λ°©λ²•**: μ‹¤μ  λ΅κ·Έ μ¶λ ¥ ν™•μΈ
```python
from claude_litellm_proxy.utils.logging import setup_logger
logger = setup_logger("test_module")
logger.info("ν…μ¤νΈ λ©”μ‹μ§€")
# μ¶λ ¥: 2025-08-22 12:44:30,695 - test_module - INFO - ν…μ¤νΈ λ©”μ‹μ§€
```

**κΈ°λ€ κ²°κ³Ό**: λ¨λ“  λ¨λ“μ—μ„ μΌκ΄€λκ³  κµ¬μ΅°ν™”λ λ΅κ·Έ μ¶λ ¥

---

### 3. FastAPI μ„λ²„ ν†µν•© κ²€μ¦ (`main.py`)

**κ²€μ¦ λ©μ **: λ§μ¤ν‚Ή μ‹μ¤ν…κ³Ό LiteLLMμ΄ FastAPI μ„λ²„μ—μ„ μ™„λ²½ν•κ² ν†µν•©λμ–΄ λ™μ‘ν•λ”μ§€ ν™•μΈ

**κ²€μ¦ λ‚΄μ©**:

#### 3.1 μ• ν”λ¦¬μΌ€μ΄μ… μƒλ…μ£ΌκΈ° κ΄€λ¦¬
- **μ΄κΈ°ν™” μμ„**: λ§μ¤ν‚Ή μ‹μ¤ν… β†’ LiteLLM ν΄λΌμ΄μ–ΈνΈ μμ„λ΅ μ΄κΈ°ν™”
- **ν™κ²½λ³€μ λ΅λ”©**: Redis μ—°κ²° μ •λ³΄, API ν‚¤ λ“± μ„¤μ • μ •λ³΄ λ΅λ”©
- **μ •λ¦¬ ν”„λ΅μ„Έμ¤**: μ• ν”λ¦¬μΌ€μ΄μ… μΆ…λ£ μ‹ λ¦¬μ†μ¤ μ •λ¦¬ (Redis μ—°κ²° ν•΄μ )

#### 3.2 μΈμ¦ μ‹μ¤ν…
- **Bearer ν† ν°**: HTTP Bearer μΈμ¦ μ¤ν‚¤λ§ μ‚¬μ©
- **API ν‚¤ κ²€μ¦**: `LITELLM_MASTER_KEY` ν™κ²½λ³€μμ™€ λΉ„κµ κ²€μ¦
- **401 μ—λ¬**: μλ»λ μΈμ¦ μ •λ³΄ μ‹ μ μ ν• μ—λ¬ μ‘λ‹µ

#### 3.3 ν—¬μ¤μ²΄ν¬ μ—”λ“ν¬μΈνΈ (`/health`)
- **λ§μ¤ν‚Ή μ‹μ¤ν… μƒνƒ**: μ΄κΈ°ν™” μ—¬λ¶€ λ° Redis μ—°κ²° μƒνƒ
- **LiteLLM ν΄λΌμ΄μ–ΈνΈ μƒνƒ**: API ν‚¤ μ„¤μ • μ—¬λ¶€ λ° μ—°κ²° ν…μ¤νΈ
- **μ „μ²΄ μ‹μ¤ν… μƒνƒ**: λ¨λ“  κµ¬μ„± μ”μ†μ ν†µν•© μƒνƒ λ³΄κ³ 

#### 3.4 Claude API ν”„λ΅μ‹ μ—”λ“ν¬μΈνΈ (`/v1/messages`)
- **μ”μ²­ νμ‹±**: JSON μ”μ²­ λ³Έλ¬Έ νμ‹± λ° μ ν¨μ„± κ²€μ‚¬
- **λ§μ¤ν‚Ή νμ΄ν”„λΌμΈ**: messages λ°°μ—΄ λ‚΄ content λ§μ¤ν‚Ή
- **LiteLLM νΈμ¶**: λ§μ¤ν‚Ήλ μ”μ²­μΌλ΅ μ‹¤μ  Claude API νΈμ¶
- **λ³µμ› νμ΄ν”„λΌμΈ**: μ‘λ‹µ content λ°°μ—΄ λ‚΄ ν…μ¤νΈ λ³µμ›
- **μ—λ¬ μ²λ¦¬**: κ° λ‹¨κ³„λ³„ μ—λ¬ μ‹ μ μ ν• HTTP μƒνƒ μ½”λ“ λ°ν™

**κ²€μ¦ λ°©λ²•**: HTTP μ”μ²­/μ‘λ‹µ ν…μ¤νΈ
```python
# ν—¬μ¤μ²΄ν¬ ν™•μΈ
response = await client.get("/health")
assert response.status_code == 200
assert response.json()["status"] == "healthy"

# μ‹¤μ  ν”„λ΅μ‹ μ”μ²­
response = await client.post("/v1/messages", 
    json=claude_request,
    headers={"Authorization": "Bearer sk-litellm-master-key"})
assert response.status_code == 200
```

**κΈ°λ€ κ²°κ³Ό**: λ¨λ“  μ—”λ“ν¬μΈνΈκ°€ μμƒλ€λ΅ λ™μ‘ν•κ³  μ μ ν• μ‘λ‹µ λ°ν™

---

### 4. μ”μ²­/μ‘λ‹µ λ§μ¤ν‚Ή νμ΄ν”„λΌμΈ κ²€μ¦

**κ²€μ¦ λ©μ **: HTTP μ”μ²­/μ‘λ‹µ μ²λ¦¬ κ³Όμ •μ—μ„ λ―Όκ°μ •λ³΄κ°€ μ™„λ²½ν•κ² λ§μ¤ν‚Ή/λ³µμ›λλ”μ§€ ν™•μΈ

**κ²€μ¦ λ‚΄μ©**:

#### 4.1 μ”μ²­ λ§μ¤ν‚Ή (`mask_request_content`)
- **messages λ°°μ—΄ μ²λ¦¬**: μ‚¬μ©μ λ©”μ‹μ§€ λ‚΄ λ―Όκ°μ •λ³΄ νƒμ§€ λ° λ§μ¤ν‚Ή
- **λ§¤ν•‘ μμ§‘**: λ¨λ“  λ§μ¤ν‚Ήλ κ°’μ— λ€ν• λ§¤ν•‘ μ •λ³΄ μμ§‘
- **κµ¬μ΅° λ³΄μ΅΄**: μ”μ²­μ JSON κµ¬μ΅°λ” μ μ§€ν•λ©΄μ„ contentλ§ λ§μ¤ν‚Ή
- **λ‹¤μ¤‘ λ©”μ‹μ§€**: μ—¬λ¬ λ©”μ‹μ§€κ°€ μλ” λ€ν™”μ—μ„λ„ μ •ν™•ν• μ²λ¦¬

#### 4.2 μ‘λ‹µ λ³µμ› (`unmask_response_content`)
- **content λ°°μ—΄ μ²λ¦¬**: Claude API μ‘λ‹µμ content λ°°μ—΄ λ‚΄ ν…μ¤νΈ λ³µμ›
- **λ§¤ν•‘ μ μ©**: μ”μ²­μ—μ„ μμ§‘λ λ§¤ν•‘ μ •λ³΄λ΅ μ •ν™•ν• λ³µμ›
- **λ¶€λ¶„ λ³µμ›**: μ‘λ‹µμ— μƒλ΅ λ“±μ¥ν• λ§μ¤ν‚Ή κ°’μ€ λ³µμ›ν•μ§€ μ•μ (μ¬λ°”λ¥Έ λ™μ‘)

#### 4.3 μ‹¤μ  μ‹λ‚λ¦¬μ¤ ν…μ¤νΈ
```python
# λ³µμ΅ν• AWS μΈν”„λΌ μ„¤λ… μ”μ²­
request_content = """
μΈν”„λΌ λ¶„μ„:
- EC2: i-1234567890abcdef0, i-abcdef1234567890a
- VPC: vpc-12345678
- IAM: AKIA1234567890ABCDEF, AKIA9876543210FEDCBA
- S3: company-data-bucket, backup-logs-bucket
"""

# λ§μ¤ν‚Ήλ μ”μ²­μ—μ„ μ›λ³Έ λ―Όκ°μ •λ³΄ μ™„μ „ μ κ±° ν™•μΈ
masked_request, mappings = await mask_request_content(request_data)
for sensitive in ["i-1234567890abcdef0", "AKIA1234567890ABCDEF"]:
    assert sensitive not in str(masked_request)

# λ³µμ›λ μ‘λ‹µμ—μ„ μ›λ³Έ μ •λ³΄ μ •ν™• λ³µμ› ν™•μΈ
unmasked_response = await unmask_response_content(claude_response, mappings)
assert "i-1234567890abcdef0" in str(unmasked_response)
```

**κΈ°λ€ κ²°κ³Ό**: λ―Όκ°μ •λ³΄ μ™„μ „ λ³΄νΈ + μ •ν™•ν• μ •λ³΄ λ³µμ›

---

### 5. ν†µν•© μ‹μ¤ν… κ²€μ¦ (`test_litellm_integration_verification.py`)

**κ²€μ¦ λ©μ **: μ „μ²΄ μ‹μ¤ν…μ΄ μ‹¤μ  ν™κ²½μ—μ„ End-to-Endλ΅ μ¬λ°”λ¥΄κ² λ™μ‘ν•λ”μ§€ ν™•μΈ

**κ²€μ¦ λ‚΄μ©**:

#### 5.1 μ‹¤μ  ν™κ²½ ν†µν•© ν…μ¤νΈ
- **Redis μ—°λ™**: μ‹¤μ  Redis μ„λ²„μ™€μ μ—°κ²° λ° λ°μ΄ν„° μμ†μ„±
- **λ§μ¤ν‚Ή μ—”μ§„**: μ‹¤μ  AWS λ¦¬μ†μ¤ ν¨ν„΄ νƒμ§€ λ° λ§μ¤ν‚Ή
- **LiteLLM ν΄λΌμ΄μ–ΈνΈ**: λ¨μ Claude API μ‘λ‹µμΌλ΅ ν†µν•© κ²€μ¦
- **μ„Έμ… μΌκ΄€μ„±**: λ™μΌν• λ―Όκ°μ •λ³΄μ— λ€ν• μΌκ΄€λ λ§μ¤ν‚Ή κ²°κ³Ό

#### 5.2 μ„±λ¥ κ²€μ¦
- **μ‘λ‹µ μ‹κ°„**: 100κ° AWS λ¦¬μ†μ¤λ¥Ό 0.15μ΄ μ΄λ‚΄ μ²λ¦¬
- **λ©”λ¨λ¦¬ ν¨μ¨μ„±**: λ€μ©λ‰ ν…μ¤νΈ μ²λ¦¬ μ‹ λ©”λ¨λ¦¬ μ‚¬μ©λ‰ μ•μ •
- **λ™μ‹μ„±**: μ—¬λ¬ μ”μ²­ λ™μ‹ μ²λ¦¬ μ‹μ—λ„ μ„±λ¥ μ μ§€

#### 5.3 λ³΄μ• κ²€μ¦
- **λ―Όκ°μ •λ³΄ λ…Έμ¶ λ°©μ§€**: λ§μ¤ν‚Ήλ μ”μ²­/μ‘λ‹µμ—μ„ μ›λ³Έ μ •λ³΄ μ™„μ „ μ κ±°
- **λ§¤ν•‘ λ³΄μ•**: Redisμ— μ €μ¥λ λ§¤ν•‘ μ •λ³΄μ μ•μ „ν• κ΄€λ¦¬
- **λ΅κΉ… λ³΄μ•**: λ΅κ·Έμ— λ―Όκ°μ •λ³΄ λ…Έμ¶λμ§€ μ•μ

**κ²€μ¦ λ°©λ²•**: μΆ…ν•© κ²€μ¦ μ¤ν¬λ¦½νΈ μ‹¤ν–‰
```bash
uv run python test_litellm_integration_verification.py
```

**κΈ°λ€ κ²°κ³Ό**: 
```
π‰ LiteLLM ν†µν•© μ™„λ£!
β… ν†µν•© κΈ°λ¥: μ„±κ³µ
β΅ μ„±λ¥: λ§μ΅±
```

---

### 6. LiteLLM ν΄λΌμ΄μ–ΈνΈ λ‹¨μ„ ν…μ¤νΈ κ²€μ¦ (`test_litellm_client.py`)

**κ²€μ¦ λ©μ **: LiteLLM ν΄λΌμ΄μ–ΈνΈμ λ¨λ“  κΈ°λ¥μ΄ λ…λ¦½μ μΌλ΅ μ¬λ°”λ¥΄κ² λ™μ‘ν•λ”μ§€ ν™•μΈ

**κ²€μ¦ λ‚΄μ©**:

#### 6.1 μ΄κΈ°ν™” ν…μ¤νΈ
- **API ν‚¤ μμ**: ν™κ²½λ³€μμ—μ„ μ¬λ°”λ¥Έ API ν‚¤ λ΅λ”©
- **API ν‚¤ μ—†μ**: API ν‚¤ μ—†μ΄λ„ μ΄κΈ°ν™” κ°€λ¥ (ν—¬μ¤μ²΄ν¬μ—μ„ μƒνƒ λ³΄κ³ )

#### 6.2 API νΈμ¶ ν…μ¤νΈ 
- **μ„±κ³µ μΌ€μ΄μ¤**: μ •μƒμ μΈ LiteLLM μ‘λ‹µ μ²λ¦¬
- **κΈ°λ³Έκ°’ μ μ©**: λ¨λΈ, max_tokens, temperature κΈ°λ³Έκ°’ μ‚¬μ©
- **νλΌλ―Έν„° μ „λ‹¬**: system λ©”μ‹μ§€, stop_sequences λ“± κ³ κΈ‰ νλΌλ―Έν„°
- **μ—λ¬ μΌ€μ΄μ¤**: API νΈμ¶ μ‹¤ν¨ μ‹ μμ™Έ μ²λ¦¬

#### 6.3 μ‘λ‹µ λ³€ν™ ν…μ¤νΈ
- **finish_reason λ§¤ν•‘**: LiteLLM β†’ Claude API ν•μ‹ λ³€ν™
  - `stop` β†’ `end_turn`
  - `length` β†’ `max_tokens`
  - `content_filter` β†’ `stop_sequence`

#### 6.4 ν—¬μ¤μ²΄ν¬ ν…μ¤νΈ
- **μ •μƒ μƒνƒ**: API νΈμ¶ μ„±κ³µ μ‹ healthy μƒνƒ
- **νƒ€μ„μ•„μ›ƒ**: 10μ΄ μ΄κ³Ό μ‹ timeout μƒνƒ
- **μ—λ¬ μƒνƒ**: μ—°κ²° μ‹¤ν¨ μ‹ error μƒνƒ

**κ²€μ¦ λ°©λ²•**: λ¨μ κ°μ²΄λ¥Ό μ‚¬μ©ν• λ‹¨μ„ ν…μ¤νΈ
```python
@patch('claude_litellm_proxy.proxy.litellm_client.litellm.acompletion')
async def test_call_claude_api_success(self, mock_completion):
    # κ° κΈ°λ¥μ„ λ…λ¦½μ μΌλ΅ ν…μ¤νΈ
```

**κΈ°λ€ κ²°κ³Ό**: λ¨λ“  λ‹¨μ„ ν…μ¤νΈ PASSED (6κ° ν…μ¤νΈ)

---

### 7. μ „μ²΄ μ‹μ¤ν… μ•μ •μ„± κ²€μ¦

**κ²€μ¦ λ©μ **: ν”„λ΅λ•μ… ν™κ²½μ—μ„λ„ μ•μ •μ μΌλ΅ λ™μ‘ν•  μ μλ”μ§€ ν™•μΈ

**κ²€μ¦ λ‚΄μ©**:

#### 7.1 μ—λ¬ λ³µκµ¬ λ¥λ ¥
- **Redis μ—°κ²° μ‹¤ν¨**: Redis μ„λ²„ λ‹¤μ΄ μ‹ μ μ ν• μ—λ¬ λ©”μ‹μ§€
- **LiteLLM API μ‹¤ν¨**: Claude API νΈμ¶ μ‹¤ν¨ μ‹ ν΄λΌμ΄μ–ΈνΈμ— μ μ ν• μ‘λ‹µ
- **μΈμ¦ μ‹¤ν¨**: μλ»λ API ν‚¤ μ‹ 401 μ—λ¬ λ°ν™
- **μ”μ²­ ν•μ‹ μ¤λ¥**: μλ»λ JSON μ‹ 422 μ ν¨μ„± κ²€μ‚¬ μ—λ¬

#### 7.2 λ¦¬μ†μ¤ κ΄€λ¦¬
- **λ©”λ¨λ¦¬ λ„μ λ°©μ§€**: μ¥μ‹κ°„ μ΄μ μ‹μ—λ„ λ©”λ¨λ¦¬ μ‚¬μ©λ‰ μ•μ •
- **μ—°κ²° κ΄€λ¦¬**: Redis μ—°κ²° ν’€ μ μ ν• κ΄€λ¦¬
- **μ •λ¦¬ ν”„λ΅μ„Έμ¤**: μ• ν”λ¦¬μΌ€μ΄μ… μΆ…λ£ μ‹ λ¨λ“  λ¦¬μ†μ¤ μ •λ¦¬

#### 7.3 λ¨λ‹ν„°λ§ λ° κ΄€μ°°μ„±
- **κµ¬μ΅°ν™”λ λ΅κΉ…**: λ¨λ“  μ£Όμ” μ΄λ²¤νΈμ— λ€ν• λ΅κ·Έ κΈ°λ΅
- **μ„±λ¥ λ©”νΈλ¦­**: μ²λ¦¬ μ‹κ°„, λ§¤ν•‘ μƒμ„± μ λ“± μ„±λ¥ μ§€ν‘
- **μƒνƒ λ³΄κ³ **: ν—¬μ¤μ²΄ν¬λ¥Ό ν†µν• μ‹μ¤ν… μƒνƒ λ¨λ‹ν„°λ§

**κ²€μ¦ λ°©λ²•**: μ¥μ‹κ°„ μ‹¤ν–‰ λ° μ¤νΈλ μ¤ ν…μ¤νΈ
```bash
# μ—¬λ¬ λ™μ‹ μ”μ²­μΌλ΅ μ•μ •μ„± ν…μ¤νΈ
for i in {1..10}; do
  curl -X POST http://localhost:8000/v1/messages \
    -H "Authorization: Bearer sk-litellm-master-key" \
    -H "Content-Type: application/json" \
    -d '{"model": "claude-3-5-sonnet", "messages": [{"role": "user", "content": "Test"}]}' &
done
wait
```

**κΈ°λ€ κ²°κ³Ό**: λ¨λ“  μ”μ²­μ΄ μ„±κ³µμ μΌλ΅ μ²λ¦¬λκ³  μ‹μ¤ν… μ•μ •μ„± μ μ§€

---

## π€ κ²€μ¦ μ‹¤ν–‰ λ°©λ²•

### μ „μ²΄ Phase 2 κ²€μ¦ μ‹¤ν–‰
```bash
# 1. μμ΅΄μ„± λ° ν™κ²½ μ„¤μ •
uv sync
export ANTHROPIC_API_KEY="your-api-key"  # μ‹¤μ  ν…μ¤νΈ μ‹

# 2. Redis μ„λ²„ μ‹μ‘
docker run -d -p 6379:6379 redis:alpine

# 3. LiteLLM ν΄λΌμ΄μ–ΈνΈ λ‹¨μ„ ν…μ¤νΈ
uv run pytest tests/test_litellm_client.py -v

# 4. ν†µν•© μ‹μ¤ν… κ²€μ¦
uv run python test_litellm_integration_verification.py

# 5. μ „μ²΄ ν…μ¤νΈ μ‹¤ν–‰ (Phase 1 + 2)
uv run pytest tests/ -v --tb=short

# 6. νƒ€μ… μ²΄ν¬ λ° μ½”λ“ ν’μ§
uv run mypy src/claude_litellm_proxy/
uv run black --check src/
```

### FastAPI μ„λ²„ μ‹¤μ  μ‹¤ν–‰ ν…μ¤νΈ
```bash
# μ„λ²„ μ‹μ‘
uv run uvicorn claude_litellm_proxy.main:app --reload --port 8000

# ν—¬μ¤μ²΄ν¬ ν™•μΈ
curl http://localhost:8000/health

# μ‹¤μ  API μ”μ²­ ν…μ¤νΈ
curl -X POST http://localhost:8000/v1/messages \
  -H "Authorization: Bearer sk-litellm-master-key" \
  -H "Content-Type: application/json" \
  -d '{
    "model": "claude-3-5-sonnet",
    "messages": [{"role": "user", "content": "Analyze EC2 i-1234567890abcdef0"}],
    "max_tokens": 100
  }'
```

## β… κ²€μ¦ μ™„λ£ κΈ°μ¤€

Phase 2κ°€ μ„±κ³µμ μΌλ΅ μ™„λ£λμ—λ‹¤κ³  νλ‹¨ν•λ” κΈ°μ¤€:

1. **LiteLLM ν΄λΌμ΄μ–ΈνΈ ν…μ¤νΈ**: 6κ° λ‹¨μ„ ν…μ¤νΈ λ¨λ‘ PASSED
2. **ν†µν•© κ²€μ¦ μ¤ν¬λ¦½νΈ**: "π‰ LiteLLM ν†µν•© μ™„λ£!" λ©”μ‹μ§€ μ¶λ ¥
3. **μ „μ²΄ ν…μ¤νΈ ν†µκ³Ό**: Phase 1 + Phase 2 λ¨λ“  ν…μ¤νΈ ν†µκ³Ό
4. **μ„±λ¥ μ”κµ¬μ‚¬ν•­**: 100κ° λ¦¬μ†μ¤ 0.2μ΄ μ΄λ‚΄ μ²λ¦¬
5. **μ‹¤μ  μ„λ²„ λ™μ‘**: FastAPI μ„λ²„κ°€ μ •μƒμ μΌλ΅ HTTP μ”μ²­ μ²λ¦¬
6. **λ§μ¤ν‚Ή νμ΄ν”„λΌμΈ**: μ”μ²­β†’λ§μ¤ν‚Ήβ†’APIνΈμ¶β†’λ³µμ› μ „ κ³Όμ • μ™„λ²½ λ™μ‘

μ΄ λ¨λ“  μ΅°κ±΄μ΄ λ§μ΅±λλ©΄ Phase 2μ LiteLLM ν†µν•©μ΄ ν”„λ΅λ•μ… μ¤€λΉ„ μ™„λ£ μƒνƒμ…λ‹λ‹¤.